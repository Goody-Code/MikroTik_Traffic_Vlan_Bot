

---

# MikroTik_Traffic_Vlan_Bot

تم تصميم هذا البوت لمساعدة مديري شبكات MikroTik في مراقبة وتقديم تقارير حول استهلاك عرض النطاق الترددي لفيلانات (VLANs) ضمن شبكتهم. يوفر البوت واجهة سهلة الاستخدام لتسمية الفيلانات، جدولة تقارير الاستهلاك، واستلام بيانات استهلاك مفصلة في الأوقات المحددة.

## نظرة عامة

هذا المشروع يتضمن واجهة API وبوت تلجرام لجمع وإرسال تقارير استهلاك الشبكة من MikroTik.

## التعليمات

### إعداد API

1. انتقل إلى مجلد `api/`:

   ```shell
   cd api/
   ```

2. قم بتثبيت المتطلبات:

   ```shell
   pip install -r requirements.txt
   ```

3. شغّل Flask API:

   ```shell
   python app.py
   ```

### إعداد البوت

1. انتقل إلى مجلد `bot/`:

   ```shell
   cd bot/
   ```

2. قم بتثبيت المتطلبات:

   ```shell
   pip install -r requirements.txt
   ```

3. شغّل البوت:

   ```shell
   python bot.py
   ```

### إعداد MikroTik

1. قم بنسخ محتويات `scripts/mikrotik_script.rsc` إلى جهاز MikroTik الخاص بك.
2. قم بتشغيل السكربت على MikroTik لجمع بيانات VLAN.

### الاستخدام

1. افتح تطبيق تلجرام وابحث عن البوت باستخدام التوكن: `@YourBotUsername`.
2. ابدأ المحادثة مع البوت باستخدام الأمر `/start`.
3. استخدم الأزرار التفاعلية لتسمية الفيلانات أو تحديد وقت الإرسال.

### نشر المشروع على Render

لرفع مشروعك على Render، ستحتاج إلى إنشاء حساب على [Render](https://render.com/) أولاً، ثم إعداد خدمتين: واحدة للـ API (واجهة Flask) وواحدة للبوت تلجرام. إليك الخطوات:

#### إنشاء حساب على Render

1. قم بزيارة [Render](https://render.com/) وأنشئ حسابًا أو سجّل الدخول إذا كان لديك حساب بالفعل.
2. اربط حسابك على Render مع GitHub للوصول إلى مستودع المشروع الخاص بك.

#### رفع مشروعك على GitHub

إذا لم يكن مشروعك موجودًا على GitHub بعد، قم برفعه:

1. إنشاء مستودع جديد على GitHub.
2. ادفع (push) مشروعك إلى المستودع الجديد:

   ```shell
   git init
   git remote add origin https://github.com/username/repository.git
   git add .
   git commit -m "Initial commit"
   git push -u origin master
   ```

#### إعداد خدمة Flask API على Render

1. بعد تسجيل الدخول إلى Render، انقر على **New** ثم **Web Service**.
2. اختر المستودع الذي يحتوي على مشروعك من GitHub.
3. في إعدادات الخدمة:
   - **Name**: اختر اسمًا لخدمتك، مثلاً `flask-api`.
   - **Root Directory**: اختر الدليل الفرعي `api/`.
   - **Environment**: اختر `Python`.
   - **Build Command**: ضع الأمر التالي لتثبيت المتطلبات:

     ```shell
     pip install -r requirements.txt
     ```

   - **Start Command**: ضع الأمر التالي لتشغيل التطبيق:

     ```shell
     python app.py
     ```

   - **Environment Variables**: أضف المتغيرات التالية إذا لزم الأمر (مثل إعدادات قاعدة البيانات أو مفاتيح API).

4. انقر على **Create Web Service** وانتظر حتى يتم بناء ونشر التطبيق.

#### إعداد خدمة البوت تلجرام على Render

1. انقر على **New** ثم **Web Service** مرة أخرى.
2. اختر نفس المستودع الذي يحتوي على مشروعك من GitHub.
3. في إعدادات الخدمة:
   - **Name**: اختر اسمًا لخدمتك، مثلاً `telegram-bot`.
   - **Root Directory**: اختر الدليل الفرعي `bot/`.
   - **Environment**: اختر `Python`.
   - **Build Command**: ضع الأمر التالي لتثبيت المتطلبات:

     ```shell
     pip install -r requirements.txt
     ```

   - **Start Command**: ضع الأمر التالي لتشغيل البوت:

     ```shell
     python bot.py
     ```

   - **Environment Variables**: أضف المتغيرات التالية:
     - `API_URL`: عنوان الـ API الذي تم نشره على Render. ستجده في صفحة خدمة الـ API التي أنشأتها، مثل: `https://flask-api.onrender.com/vlan_data`.
     - `TOKEN`: توكن البوت الخاص بك.

4. انقر على **Create Web Service** وانتظر حتى يتم بناء ونشر التطبيق.

### تعديل كود البوت لاستخدام عنوان الـ API المنشور

افتح `bot/bot.py` وعدّل `API_URL` ليكون عنوان الخدمة المنشورة على Render:

```python
API_URL = 'https://flask-api.onrender.com/vlan_data'  # استبدل بالعنوان الفعلي
```

### إعادة نشر البوت على Render

1. بعد تعديل `bot.py`، ادفع التغييرات إلى GitHub:

   ```shell
   git add bot/bot.py
   git commit -m "Update API_URL to use Render service URL"
   git push
   ```

2. Render سيقوم برصد التغييرات تلقائيًا ويعيد بناء ونشر خدمة البوت.

### التأكد من التشغيل

1. تأكد من أن خدمة Flask API تعمل بشكل صحيح من خلال زيارة عنوان URL الخاص بها الذي تم نشره.
2. تأكد من أن البوت يعمل من خلال إرسال أوامر في تلجرام.

باتباع هذه الخطوات، يجب أن تكون قادرًا على نشر مشروعك بالكامل على Render وتشغيله دون مشاكل. إذا واجهت أي صعوبات، يمكنك دائمًا الرجوع إلى [وثائق Render](https://render.com/docs) للحصول على مزيد من التفاصيل.

## ملاحظات

- تأكد من أن جهاز MikroTik يمكنه الوصول إلى الخادم الذي يشغّل Flask API.
- تأكد من إعداد جدار الحماية للسماح بالاتصالات على المنفذ 5000 إذا كنت تستخدم خادمًا بعيدًا.

## استكشاف الأخطاء وإصلاحها

- إذا كنت تواجه مشاكل في الاتصال بجهاز MikroTik، تحقق من إعدادات الشبكة وكلمة المرور.
- إذا لم يعمل البوت بشكل صحيح، تحقق من سجلات الأخطاء في وحدة التحكم.

## تحسينات مستقبلية

- إضافة مصادقة وأمان للـ API.
- تحسين واجهة المستخدم للبوت لإضافة مزيد من الخيارات.
- تكامل مع أنظمة مراقبة أخرى.

---

باتباع هذه التعليمات، يجب أن تكون قادرًا على إعداد وتشغيل الـ API والبوت بشكل كامل. إذا كان لديك أي استفسارات أو تحتاج إلى مزيد من المساعدة، لا تتردد في طرحها.

## المطور

- خالد الغيلي

## الرخصة

- MIT License
